# テンプレートメンテナンスガイド

このドキュメントは、Spec-Driven Development Templateの継続的な保守と更新に関するガイドラインを提供します。

## 📋 目次

- [概要](#概要)
- [メンテナンススケジュール](#メンテナンススケジュール)
- [更新プロセス](#更新プロセス)
- [メンテナンスコマンド](#メンテナンスコマンド)
- [バージョニング](#バージョニング)
- [品質基準](#品質基準)
- [トラブルシューティング](#トラブルシューティング)

## 概要

### メンテナンスの目的

このテンプレートは、以下の要因により定期的な更新が必要です:

1. **Claude Codeの進化**
   - 新機能の追加
   - APIの変更
   - ベストプラクティスの更新

2. **開発エコシステムの変化**
   - Node.js、TypeScript、Next.jsなどのアップデート
   - 新しいツールやライブラリの登場
   - セキュリティアップデート

3. **ベストプラクティスの進化**
   - Spec-Driven Developmentの改善
   - AI支援開発の新しいパターン
   - コミュニティからのフィードバック

### メンテナンスの原則

- **後方互換性**: 可能な限り既存のプロジェクトに影響を与えない
- **段階的な更新**: 大きな変更は複数のバージョンに分散
- **明確なドキュメント**: すべての変更を詳細に記録
- **品質保証**: 更新前後で品質スコアを維持

## メンテナンススケジュール

### 定期メンテナンス

| 頻度 | タスク | 担当コマンド |
|------|--------|------------|
| **毎月** | 健全性チェック | `/check-template-health` |
| **毎月（⭐新）** | レビュー管理の棚卸し | 手動（詳細は下記） |
| **四半期** | 詳細スキャンと更新計画 | `/template-update-scan` |
| **半年** | メジャーアップデートの検討 | 手動レビュー |
| **随時** | セキュリティパッチ | 緊急対応 |

### 更新トリガー

以下の場合は、スケジュール外でも更新を検討:

- ✅ セキュリティ脆弱性の発見
- ✅ Claude Codeのメジャーアップデート
- ✅ 重大なバグの報告
- ✅ コミュニティからの重要なフィードバック

## 更新プロセス

### フロー図

```
[定期チェック] → [健全性評価] → [更新必要?]
                                    ↓ Yes
                    [更新ブランチ作成] ← [緊急対応]
                            ↓
                    [詳細スキャン実行]
                            ↓
                    [更新計画の作成]
                            ↓
                    [実装と検証]
                            ↓
                    [クリーンアップ]
                            ↓
                    [マージ準備]
                            ↓
                    [レビューとマージ]
                            ↓
                    [リリースとタグ付け]
```

### Step 1: 健全性チェック

月次の定期チェックを実行:

```bash
# 健全性スコアの確認
/check-template-health
```

**判定基準:**
- スコア 90-100: 更新不要
- スコア 70-89: 軽微な更新推奨
- スコア 50-69: 更新推奨
- スコア 0-49: 早急な更新が必要

### Step 2: 更新ブランチの作成

更新が必要な場合、専用ブランチを作成:

```bash
# 更新ブランチの作成
git checkout main
git pull origin main
git checkout -b template-update/v1.x

# または緊急修正の場合
git checkout -b fix/security-patch
```

**ブランチ命名規則:**
- `template-update/v1.x`: 定期更新
- `fix/[issue-name]`: バグ修正
- `feature/[feature-name]`: 新機能追加

### Step 3: 詳細スキャンの実行

外部環境の変更を詳細にスキャン:

```bash
# 詳細スキャンの実行
/template-update-scan
```

このコマンドは以下を分析:
- Claude Codeの更新
- 開発エコシステムの変化
- ベストプラクティスの進化
- セキュリティ更新

### Step 4: 更新計画の作成

スキャン結果を基に更新計画を作成:

```markdown
# Update Plan v1.x

## 優先度: 高
1. [項目名]
   - 理由: [...]
   - 影響範囲: [...]
   - 工数: [...]時間

## 優先度: 中
[...]

## 優先度: 低
[...]
```

### Step 5: 実装

優先度の高い項目から順に実装:

```bash
# 例: 依存関係の更新
npm update

# 例: ドキュメントの更新
# Edit toolを使用して更新

# 例: テンプレートファイルの改善
# Read → Edit の流れで更新
```

**ベストプラクティス:**
- 小さな変更ごとにコミット
- わかりやすいコミットメッセージ
- 変更内容をCHANGELOG.mdに記録

### Step 6: 検証

各変更後に健全性チェックを実行:

```bash
# 変更後の検証
/check-template-health

# スコアが90以上を維持していることを確認
```

### Step 7: クリーンアップとマージ準備

プロジェクト固有ファイルを削除し、テンプレートとして整理:

```bash
# クリーンアップとバージョン更新
/merge-template-update
```

このコマンドは以下を実行:
- プロジェクト固有ファイルの削除
- テンプレート必須ファイルの確認
- バージョン情報の更新
- .gitignoreの検証

### Step 8: レビューとマージ

```bash
# 変更内容のレビュー
git diff main

# コミット
git add .
git commit -m "chore: template update v1.x

- [変更内容1]
- [変更内容2]
- [変更内容3]"

# mainブランチにマージ
git checkout main
git merge template-update/v1.x
```

### Step 9: リリース

```bash
# タグの作成
git tag v1.x.0
git tag -a v1.x.0 -m "Release v1.x.0

## Changes
- [変更内容1]
- [変更内容2]"

# リモートにプッシュ
git push origin main
git push origin v1.x.0

# 更新ブランチの削除
git branch -d template-update/v1.x
```

## メンテナンスコマンド

### `/check-template-health`

**目的**: テンプレートの健全性と更新必要性をチェック

**使用タイミング:**
- 月次定期チェック
- 更新作業の前後
- 問題発生時の診断

**出力:**
- 健全性スコア（0-100）
- カテゴリ別評価
- 推奨アクション

### `/template-update-scan`

**目的**: 外部環境の変更を検知して更新必要箇所を特定

**使用タイミング:**
- 健全性スコアが80以下の場合
- 四半期ごとの詳細レビュー
- メジャーアップデート前

**出力:**
- 検出された変更の詳細
- 優先度マトリクス
- アクションプラン

### `/merge-template-update`

**目的**: 更新ブランチをmainにマージする前のクリーンアップ

**使用タイミング:**
- 更新作業完了後
- mainブランチへのマージ前

**出力:**
- 削除されたファイルのリスト
- 保持されたファイルの確認
- 最終健全性スコア

## バージョニング

### セマンティックバージョニング

このテンプレートは[セマンティックバージョニング](https://semver.org/)に従います:

```
MAJOR.MINOR.PATCH

例: 1.2.3
```

**バージョン番号の意味:**

- **MAJOR (1.x.x)**: 破壊的変更
  - 既存のプロジェクトに影響を与える変更
  - マイグレーションガイドが必要
  - 例: スラッシュコマンドの構文変更

- **MINOR (x.2.x)**: 新機能追加
  - 後方互換性を保ちつつ新機能を追加
  - 既存のプロジェクトには影響なし
  - 例: 新しいスラッシュコマンドの追加

- **PATCH (x.x.3)**: バグ修正
  - バグ修正やドキュメント改善
  - 機能の変更なし
  - 例: ドキュメントの誤字修正

### バージョン管理ファイル

#### `.template-config.json`

```json
{
  "version": "1.1.0",
  "lastUpdated": "2025-11-14",
  "updateHistory": [
    {
      "version": "1.1.0",
      "date": "2025-11-14",
      "type": "minor",
      "changes": ["..."],
      "breakingChanges": false,
      "migrationRequired": false
    }
  ]
}
```

#### `CHANGELOG.md`

```markdown
## [1.1.0] - 2025-11-14

### Added
- 新機能の追加

### Changed
- 既存機能の変更

### Deprecated
- 非推奨になった機能

### Removed
- 削除された機能

### Fixed
- バグ修正

### Security
- セキュリティ修正
```

## 品質基準

### 最低品質要件

更新後は以下の基準を満たす必要があります:

| 項目 | 最低スコア | 推奨スコア |
|------|-----------|-----------|
| 構造の完全性 | 90 | 95 |
| 互換性 | 80 | 90 |
| ドキュメント品質 | 85 | 95 |
| セキュリティ | 95 | 100 |
| 最新性 | 70 | 85 |
| **総合スコア** | **80** | **90** |

### チェックリスト

更新完了前に以下を確認:

#### テンプレート構造
- [ ] すべての必須ファイルが存在（45ファイル）
- [ ] ディレクトリ構造が正しい
- [ ] .gitkeepファイルが保持されている

#### コマンド
- [ ] すべてのスラッシュコマンドが動作（15個）
- [ ] メタデータが正しい
- [ ] 出力言語指定がある

#### テンプレート
- [ ] すべてのテンプレートファイルが存在（8個）
- [ ] プレースホルダー構文が一貫
- [ ] サンプルとの整合性がある

#### ドキュメント
- [ ] READMEが最新
- [ ] CHANGELOGが更新されている
- [ ] 内部リンクが有効
- [ ] 最終更新日が正しい

#### 設定
- [ ] .template-config.jsonのバージョンが更新
- [ ] .gitignoreが適切
- [ ] .template-ignoreが最新

#### Git
- [ ] コミットメッセージが明確
- [ ] タグが付けられている
- [ ] 変更内容がCHANGELOGに記録

---

## ⭐ レビュー管理のメンテナンス（新機能）

### 概要

レビュー管理システムは、スペックレビューの結果と改善項目を継続的に追跡します。
定期的なメンテナンスにより、レビュー結果の価値を最大化し、改善項目の対処漏れを防ぎます。

### 毎月の棚卸しタスク

#### 1. Pendingレビューの確認

**目的**: 未対応のレビューを可視化し、対処を促進

**手順**:
```bash
# 1. Pendingレビューのリスト確認
ls -la specs/reviews/pending/

# 2. 各レビューの経過日数を確認
for file in specs/reviews/pending/*.md; do
  echo "=== $(basename $file) ==="
  grep "レビュー日" $file
done

# 3. 30日以上経過したレビューを警告
find specs/reviews/pending/ -type f -mtime +30
```

**アクション**:
- 30日以上経過: ステークホルダーに通知、対処期限設定
- 60日以上経過: エスカレーション、実装ブロックの検討

#### 2. 改善項目の進捗確認

**目的**: 改善項目の対処状況を追跡

**手順**:
```bash
# 1. Critical項目の確認（0件が正常）
ls -la specs/improvements/critical/ | wc -l

# 2. Important項目の期限チェック
grep -r "期限:" specs/improvements/important/

# 3. Minor項目のカウント
grep -c "###" specs/improvements/minor/index.md
```

**アクション**:
- Critical項目が存在: 即座に対処、実装をブロック
- Important項目で期限超過: 優先度を再評価、リスケジュール
- Minor項目が10件以上: まとめて対処、または優先度見直し

#### 3. レビューメトリクスの更新

**目的**: `/specs/reviews/index.md` のメトリクスを最新化

**更新項目**:
```markdown
## メトリクス

- **平均レビュースコア**: X%
  計算: 全レビューの総合スコアの平均

- **改善項目対処率**: X% (Y/Z)
  計算: (完了した改善項目数 / 総改善項目数) × 100

- **Critical Issue 発生率**: X%
  計算: (Critical項目があったレビュー数 / 総レビュー数) × 100

- **レビュー→実装の平均時間**: X日
  計算: レビュー日から実装完了日までの平均日数
```

**手順**:
1. 各レビューファイルからスコアを収集
2. 改善項目の対処状況を集計
3. メトリクスを計算してindex.mdを更新

#### 4. 完了レビューのアーカイブ

**目的**: すべての改善項目が対処済みのレビューをアーカイブ

**判断基準**:
- すべてのCritical項目が完了
- すべてのImportant項目が完了
- Minor項目は80%以上完了、または不要と判断

**手順**:
```bash
# 1. 対処済みレビューの特定（手動確認）
cat specs/reviews/pending/[feature-name].md
# すべての改善項目が完了か確認

# 2. completedディレクトリに移動
mv specs/reviews/pending/[feature-name].md \
   specs/reviews/completed/[feature-name].md

# 3. 完了情報を追記
echo "\n## 完了情報\n- 完了日: $(date +%Y-%m-%d)\n- すべての改善項目対処済み" >> \
  specs/reviews/completed/[feature-name].md

# 4. 改善項目ファイルのアーカイブ
mkdir -p specs/improvements/archive/[feature-name]
mv specs/improvements/*/[related-improvements].md \
   specs/improvements/archive/[feature-name]/
```

### 四半期の詳細レビュー

#### 1. レビュープロセスの評価

**評価項目**:
- **効果性**: レビューで検出された問題が実装前に発見されているか
- **効率性**: レビュー→対処の平均時間が適切か
- **一貫性**: レビュースコアの基準が一貫しているか

**改善アクション**:
- レビューチェックリストの更新
- スコアリング基準の調整
- レビュープロセスの簡素化

#### 2. テンプレートの更新

**確認項目**:
- レビュー結果テンプレートが最新のベストプラクティスを反映しているか
- 改善項目テンプレートに必要な情報が網羅されているか
- 新しい優先度レベルや分類が必要か

**更新手順**:
1. `/specs/templates/review_result.template.md` を確認（該当時）
2. `/specs/templates/improvement_item.template.md` を確認（該当時）
3. 必要に応じて更新
4. 更新履歴を記録

#### 3. ベストプラクティスの抽出

**目的**: 効果的だった改善パターンを文書化

**手順**:
1. 完了した改善項目をレビュー
2. 特に効果的だったパターンを特定
3. `/docs/BEST_PRACTICES.md` に追加（該当時）
4. チームで共有

### トラブルシューティング

#### 問題: レビュースコアが一貫しない

**症状**: 同様の品質のスペックで異なるスコア

**原因**:
- スコアリング基準が不明確
- レビュアーによる解釈の違い

**対処法**:
1. スコアリング基準を明文化
2. レビューチェックリストの詳細化
3. サンプルレビューの作成

#### 問題: 改善項目が対処されない

**症状**: Important項目が長期間Pending

**原因**:
- 期限が不明確
- 担当が割り当てられていない
- 優先度が不適切

**対処法**:
1. 期限を明確に設定
2. 担当者をアサイン
3. 週次/月次で進捗確認
4. 必要に応じて優先度を再評価

#### 問題: レビュー結果が実装に反映されない

**症状**: 実装後に同じ問題が再発

**原因**:
- `/implement` コマンドでのレビュー参照が機能していない
- 開発者がレビュー結果を見ていない

**対処法**:
1. `/implement` コマンドのStep 0を強化
2. レビュー結果の通知を改善
3. コミットメッセージでのレビュー参照を必須化

### レビュー管理の品質基準

#### 優秀（Excellent）
- ✅ すべてのレビューが30日以内に完了
- ✅ 平均レビュースコア >90%
- ✅ 改善項目対処率 >80%
- ✅ Critical Issue発生率 <5%

#### 良好（Good）
- ✅ 80%のレビューが60日以内に完了
- ✅ 平均レビュースコア >85%
- ✅ 改善項目対処率 >60%
- ✅ Critical Issue発生率 <10%

#### 要改善（Needs Improvement）
- ⚠️ 50%以上のレビューが60日超Pending
- ⚠️ 平均レビュースコア <85%
- ⚠️ 改善項目対処率 <60%
- ⚠️ Critical Issue発生率 >10%

---

## 自動化ツール

### GitHub Actions

テンプレートリポジトリでは、GitHub Actionsが自動的にヘルスチェックを実行します。

**ワークフロー**: `.github/workflows/template-health-check.yml`

**実行タイミング:**
- 月次（毎月1日）
- template-update/* ブランチへのpush
- mainへのPull Request
- 手動トリガー

**リポジトリ検出:**
テンプレートから作成されたプロジェクトでは、このワークフローは自動的にスキップされます。`.template-config.json`の`repository`フィールドでテンプレートリポジトリかどうかを判定します。

```yaml
# .template-config.jsonの例
{
  "repository": "https://github.com/ronkovic/spec-driven-template"
}
```

### サブエージェント

#### template-health-agent

**タイプ**: Explore
**役割**: テンプレートの健全性を包括的に分析

**分析項目:**
- 構造の完全性（ファイル、ディレクトリ）
- 互換性（Claude Code、Node.js、フレームワーク）
- ドキュメント品質（リンク、最新性）
- セキュリティ（脆弱性、非推奨パッケージ）
- 最新性（更新頻度、外部環境との比較）

**出力**: JSON/Markdown形式の詳細レポート

#### template-updater-agent

**タイプ**: general-purpose
**役割**: 検出された問題を自動修正

**更新可能な項目:**
- 依存関係の更新（自動）
- 設定ファイルの更新（自動）
- ドキュメントの日付/バージョン更新（自動）
- .gitignoreパターンの追加（自動）
- テンプレートファイルの改善（手動承認）

**安全機能:**
- ドライランモード
- 自動バックアップ
- ロールバック機能
- 更新後の自動検証

### スキル

#### dependency-updater

**目的**: package.jsonと依存関係の安全な自動更新

**機能:**
- 現状分析（npm outdated, npm audit）
- 段階的更新（Security → Patch → Minor → Major）
- 自動ロールバック
- Breaking changes検出

**使用例:**
```bash
# セキュリティ更新
npm audit fix

# Patch/Minor更新
npm update

# 検証
npm test && npm run build
```

## トラブルシューティング

### 健全性スコアが低い

**症状**: `/check-template-health` のスコアが80以下

**対処法:**
1. `/template-update-scan` で詳細を確認
2. 優先度の高い項目から対応
3. 各修正後に再チェック

### GitHub Actions が実行されない

**症状**: テンプレートリポジトリでワークフローが実行されない

**対処法:**
1. `.template-config.json`の`repository`フィールドを確認
2. 正しいリポジトリURLが設定されているか確認
3. ワークフローファイルが`.github/workflows/`に存在するか確認

### プロジェクトで意図せずActions が実行される

**症状**: テンプレートから作成したプロジェクトでワークフローが実行される

**対処法:**
1. `.template-config.json`を削除または`repository`フィールドを変更
2. または`.github/workflows/template-health-check.yml`を削除

### マージ時の競合

**症状**: mainブランチへのマージ時に競合が発生

**対処法:**
```bash
# mainの最新状態を取得
git checkout main
git pull origin main

# 更新ブランチで最新のmainをマージ
git checkout template-update/v1.x
git merge main

# 競合を解決
# [競合ファイルを編集]
git add .
git commit -m "chore: resolve merge conflicts"
```

### 必須ファイルの誤削除

**症状**: `/merge-template-update` 後に必須ファイルがない

**対処法:**
```bash
# 前のコミットから復元
git checkout HEAD~1 [ファイルパス]

# または、mainブランチから復元
git checkout main -- [ファイルパス]
```

### 更新後の互換性問題

**症状**: 既存のプロジェクトで問題が発生

**対処法:**
1. 変更内容をCHANGELOGで確認
2. 破壊的変更がある場合はマイグレーションガイドを参照
3. 必要に応じて前のバージョンにロールバック:
```bash
git checkout v1.x.0
```

## コントリビューション

テンプレートの改善にご協力いただける場合:

1. **Issue作成**: バグや改善提案を報告
2. **Pull Request**: 具体的な改善を提案
3. **Discussion**: アイデアや質問を共有

詳細は [CONTRIBUTING.md](../CONTRIBUTING.md) を参照。

## 関連ドキュメント

- [README.md](../README.md) - テンプレート概要
- [CHANGELOG.md](../CHANGELOG.md) - 変更履歴
- [CONTRIBUTING.md](../CONTRIBUTING.md) - コントリビューションガイド
- [WORKFLOW_GUIDE.md](./WORKFLOW_GUIDE.md) - ワークフローガイド

---

**最終更新**: 2025-11-14
**バージョン**: 1.1.0
**ステータス**: 完成
